### 事件循环引入
*   每一个浏览器都至少有一个事件循环，每一个事件循环至少有一个任务队列，循环指的是其永远处于一个无限循环中，不断将注册的回调函数推入到执行栈中。
*   浏览器事件循环 vs NodeJS事件循环
*   JS引擎的作用：讲JS文本变成一段机器可以理解的计算机指令（V8：只有栈和堆）
*   执行（上下文）栈 & 堆（内存）
*   浏览器或者Node的作用是啥
    *   执行环境，提供JS可以调用的API
*   JS执行栈和渲染线程相互阻塞
*   设计模式：单线程 + 异步
    *   事件循环：调度器，决定V8什么时候执行代码
*   小结：
    *   V8
        *   一个调用栈，同一时间只能执行一段代码
        *   堆
    *   浏览器运行环境
        *   WEB API
        *   DOM API
        *   任务队列
    *   事件循环
        *   碰到异步代码，浏览器会将用户注册的回调函数存起来跑后面的代码，异步任务完成了，触发事件，浏览器会将“任务的详细信息”作为参数传递给之前用户绑定的回调函数=>将用户绑定的回调函数推入浏览器的执行栈
        *   如果没有绑定回调，执行完的消息无效，没有函数加入执行栈
*   宏任务与微任务
    ```
    执行顺序.js
    console.log(1);
    setTime(()=>{console.log(2)},0)
    Promise.resolve().then(()=>{
        return console.log(3);
    }).then(()=>{
        console.log(4)
    })
    console.log(5)
    //输出
    //1，5，3，4，2
    ```
*   简单解释
    *   浏览器首先执行宏任务<script>
    *   完成之后检查是否存在微任务，不断执行，直到清空队列
    *   执行宏任务
*   宏任务
    *   <script></script>，setTimeout, setInterval, I/O, UI交互事件
*   微任务
    *   Promise

* 再谈！
    *   所有JS引擎（V8：chrome/NodeJS）都有一个堆和一个调用栈
    *   堆：内存堆，内存分配发生的地方，存储程序需要的所有对象
    *   调用栈：实际代码执行的地方
    *   引擎并不孤立运行，需要运行时环境
        *   浏览器，nodejs就是运行时环境
        *   运行时环境提供事件处理、事件循环、回调队列、消息队列、网络请求API等
    *   浏览器chrome：多进程架构
        *   浏览器进程
        *   插进进程
        *   GPU进程
        *   渲染进程
            * 浏览器内核（如webkit）,多线程
                *   GUI渲染线程
                *   一个进程，多线程，为线程分配CPU资源等
                *   事件触发线程
                *   GUI渲染线程：回流重绘
                *   异步HTTP请求
                *   JavaScript引擎线程
                    *   与GUI渲染线程互斥
            *渲染进程可能有多个
    * 为什么JS是单线程？
        *   操作DOM
    *   JS单线程
        *   第一个调用堆栈，一次只能做一件事
            *   调用堆栈
                *   记录我们在程序中的位置
                *   执行函数，放到栈顶，返回函数，pop
    *   V8工作流程

![微信图片_20220314225150.png](https://s2.loli.net/2022/03/14/Lra3UKX2YEt8AHI.png)
*   上图核心
    *   解析器
        *   js->AST抽象语法树   
        *   词法、语法分析
    *   解释器   
        *   将AST转换为字节码，收集编译器需要的优化编译信息
    *   编译器
        *   将字节码转化为优化的机器码
    *   解释执行，编译执行混合：JIT，即时编译（V8）
    *   “只负责执行”，给啥执行啥
        *   宏、微那些是浏览器运行环境引入的
        *   单线程+异步
            *   引入事件循环避免阻塞
            *   事件循环用来调度
            *   “等到执行好”再将回调函数推到执行栈
            






       
